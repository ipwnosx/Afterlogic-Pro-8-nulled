(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{"1xZj":function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("0h2I"),r=s("wd/R"),o=s("nKlx"),l=s("RN+F"),h=s("AFLV"),c=s("Yjhd"),u=s("JFZZ"),d=s("IAk5"),p=s("OgeD"),m=s("SQrT"),b=s("hPb3"),f=s("76Kh"),y=s("czxF"),v=s("1grR"),E=s("20Ah"),C=s("aM42"),k=s("KA8O"),g=s("gcGb"),D=s("tqo6");function A(){y.call(this),this.modified=!1,this.isPublic=d.isPublic(),this.isEditable=a.observable(!1),this.isEditableReminders=a.observable(!1),this.selectedCalendarIsShared=a.observable(!1),this.selectedCalendarIsEditable=a.observable(!1),this.callbackSave=null,this.callbackDelete=null,this.timeFormatMoment="HH:mm",this.dateFormatMoment="MM/DD/YYYY",this.dateFormatDatePicker="mm/dd/yy",this.ampmTimeFormat=a.observable(!1),this.calendarId=a.observable(null),this.id=a.observable(null),this.uid=a.observable(null),this.recurrenceId=a.observable(null),this.allEvents=a.observable(Enums.CalendarEditRecurrenceEvent.AllEvents),this.isMyEvent=a.observable(!1),this.startDom=a.observable(null),this.endDom=a.observable(null),this.repeatEndDom=a.observable(null),this.yearlyDayText=a.observable(""),this.monthlyDayText=a.observable(""),this.subject=a.observable("").extend({disableLinebreaks:!0}),this.description=a.observable(""),this.lockSelectStartEndDate=a.observable(!1),this.startDate=a.observable(""),this.startTime=a.observable(""),this.startTime.subscribe((function(){this.selectStartDate()}),this),this.allDay=a.observable(!1),this.allDay.subscribe((function(){this.allDay()||this.setActualTime()}),this),this.endDate=a.observable(""),this.endTime=a.observable(""),this.endTime.subscribe((function(){this.selectEndDate()}),this),this.repeatEndDate=a.observable(""),this.isEvOneDay=a.observable(!0),this.isEvOneTime=a.observable(!0),this.isRepeat=a.observable(!1),this.location=a.observable("").extend({disableLinebreaks:!0}),this.repeatPeriodOptions=a.observableArray(this.getDisplayedPeriods()),this.repeatWeekIntervalOptions=a.observableArray([1,2,3,4]),this.defaultAlarms=a.observableArray([5,10,15,30,60,120,180,240,300,360,420,480,540,600,660,720,1080,1440,2880,4320,5760,10080,20160]),this.alarmOptions=a.observableArray([]),this.timeOptions=a.observableArray(C.getTimeListStepHalfHour(b.timeFormat()!==Enums.TimeFormat.F24?"hh:mm A":"HH:mm")),b.timeFormat.subscribe((function(){this.timeOptions(C.getTimeListStepHalfHour(b.timeFormat()!==Enums.TimeFormat.F24?"hh:mm A":"HH:mm"))}),this),this.displayedAlarms=a.observableArray([]),this.displayedAlarms.subscribe((function(){this.disableAlarms()}),this),this.excluded=a.observable(!1),this.repeatPeriod=a.observable(Enums.CalendarRepeatPeriod.None),this.repeatPeriod.subscribe((function(t){this.setDayOfWeek(),this.isRepeat(!!t)}),this),this.repeatInterval=a.observable(1),this.repeatCount=a.observable(null),this.repeatWeekNum=a.observable(null),this.weekMO=a.observable(!1),this.weekTU=a.observable(!1),this.weekWE=a.observable(!1),this.weekTH=a.observable(!1),this.weekFR=a.observable(!1),this.weekSA=a.observable(!1),this.weekSU=a.observable(!1),this.always=a.observable(1),this.appointment=a.observable(!1),this.attendees=a.observableArray([]),this.attenderStatus=a.observable(0),this.owner=a.observable(""),this.ownerName=a.observable(""),this.recivedAnim=a.observable(!1).extend({autoResetToFalse:500}),this.whomAnimate=a.observable(""),this.guestAutocompleteItem=a.observable(null),this.guestAutocomplete=a.observable(""),this.guestEmailFocus=a.observable(!1),this.guestAutocomplete.subscribe((function(t){""===t&&this.guestAutocompleteItem(null)}),this),this.condition=a.observable(""),this.autosizeTrigger=a.observable(!0),this.calendars=null,this.calendarsList=a.observableArray([]),this.calendarColor=a.observable(""),this.selectedCalendarId=a.observable(""),this.selectedCalendarName=a.observable(""),this.selectedCalendarId.subscribe((function(t){if(t){var e=this.calendars.getCalendarById(t);this.selectedCalendarName(e.name()),this.selectedCalendarIsShared(e.isShared()),this.selectedCalendarIsEditable(e.isEditable()),this.changeCalendarColor(t)}}),this),this.subjectFocus=a.observable(!1),this.descriptionFocus=a.observable(!1),this.locationFocus=a.observable(!1),this.dateEdit=a.observable(!1),this.repeatEdit=a.observable(!1),this.guestsEdit=a.observable(!1),this.isEditForm=a.computed((function(){return!!this.id()}),this),this.callbackAttendeeActionDecline=null,this.bAllowAppointments=D.AllowAppointments,this.bAllowTasks=D.AllowTasks,this.eventType=a.observable("VEVENT"),this.status=a.observable(!1),this.isTask=a.observable(!1),this.isTaskApp=a.observable(!1),this.withDate=a.observable(!0),this.isTask.subscribe((function(t){this.eventType(t?"VTODO":"VEVENT")}),this),this.allChanges=a.computed((function(){this.subject(),this.description(),this.location(),this.isRepeat(),this.allDay(),this.repeatPeriod(),this.repeatInterval(),this.repeatCount(),this.repeatWeekNum(),this.startDate(),this.startTime(),this.endDate(),this.endTime(),this.repeatEndDate(),this.displayedAlarms(),this.weekMO(),this.weekTU(),this.weekWE(),this.weekTH(),this.weekFR(),this.weekSA(),this.weekSU(),this.always(),this.attendees(),this.selectedCalendarId(),this.status(),this.isTask(),this.withDate(),this.modified=!0}),this),this.aReminderPhrase=l.i18n("CALENDARWEBCLIENT/INFO_REMINDER").split("%"),this.isAppointmentButtonsVisible=a.observable(!1)}i.extendOwn(A.prototype,y.prototype),A.prototype.PopupTemplate="CalendarWebclient_EditEventPopup",A.prototype.createDatePickerObject=function(t,e){n(t).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:o.getMonthNamesArray(),dayNamesMin:l.i18n("COREWEBCLIENT/LIST_DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",firstDay:D.WeekStartsOn,showOn:"both",buttonText:"",buttonImage:"./static/styles/images/calendar-icon.png",buttonImageOnly:!0,dateFormat:this.dateFormatDatePicker,onSelect:e}),n(t).mousedown((function(){n("#ui-datepicker-div").toggle()}))},A.prototype.initializeDatePickers=function(){this.createDatePickerObject(this.startDom(),this.selectStartDate.bind(this)),this.createDatePickerObject(this.endDom(),this.selectEndDate.bind(this)),this.createDatePickerObject(this.repeatEndDom(),function(t){this.repeatEndDate(t)}.bind(this)),this.startDom().datepicker("option","dateFormat",this.dateFormatDatePicker),this.endDom().datepicker("option","dateFormat",this.dateFormatDatePicker),this.repeatEndDom().datepicker("option","dateFormat",this.dateFormatDatePicker)},A.prototype.onOpen=function(t){var e=d.getUserPublicId(),s=null,a=null,o="",l=null,h="",u=r();this.withDate(!!t.Start&&!!t.End),t.Start||t.End||(u.minutes()>30?u.add(60-u.minutes(),"minutes"):u.minutes(30),u.seconds(0).milliseconds(0),t.Start=u,t.End=u.clone().add(30,"minutes")),s=t.End?t.End.clone():null,a=t.Start?t.Start.clone():null,this.iDiffInMinutes=null,this.eventType(t.Type||"VEVENT"),this.isTask("VTODO"===this.eventType()),this.calendarId(t.SelectedCalendar),this.calendars=t.Calendars,(l=this.calendars.getCalendarById(this.calendarId()))&&(h=l.owner()),this.callbackSave=t.CallbackSave,this.callbackDelete=t.CallbackDelete,this.callbackAttendeeActionDecline=t.CallbackAttendeeActionDecline,this.timeFormatMoment=t.TimeFormat,this.dateFormatMoment=c.getDateFormatForMoment(t.DateFormat),this.dateFormatDatePicker=C.getDateFormatForDatePicker(t.DateFormat),this.ampmTimeFormat(b.timeFormat()!==Enums.TimeFormat.F24),this.initializeDatePickers(),this.allDay(t.AllDay),a&&(this.setStartDate(a,!0),this.startTime(a.format(this.timeFormatMoment))),s&&this.allDay()&&s.subtract(1,"days"),!s&&a&&(s=a),s&&(this.setEndDate(s,!0),this.endTime(s.format(this.timeFormatMoment))),this.calendars&&this.calendarsList(i.filter(this.calendars.collection(),(function(t){return t.isEditable()}))),this.selectedCalendarId(t.SelectedCalendar),this.selectedCalendarId.valueHasMutated(),this.changeCalendarColor(this.selectedCalendarId()),this.id(t.ID||null),this.uid(t.Uid||null),this.recurrenceId(t.RecurrenceId||null),this.subject(t.Subject||""),this.status(t.Status||!1),this.location(t.Location||""),this.description(t.Description||""),this.allEvents(t.AllEvents||Enums.CalendarEditRecurrenceEvent.AllEvents),this.isTaskApp(t.IsTaskApp||!1),this.populateAlarms(t.Alarms),this.appointment(t.Appointment),this.attendees(t.Attendees||[]),n.isFunction(d.getAttendee)&&(o=d.getAttendee(this.attendees())),this.isMyEvent(o!==e&&(e===t.Owner||e===h)),this.editableSwitch(this.selectedCalendarIsShared(),this.selectedCalendarIsEditable(),this.isMyEvent()),this.setCurrentAttenderStatus(o,t.Attendees||[]),this.owner(t.Owner||e),this.ownerName(t.OwnerName||(this.isMyEvent()&&this.owner()===e?e:"")),this.guestAutocomplete(""),this.excluded(t.Excluded||!1),this.repeatRuleParse(t.RRule||null),null===this.id()&&this.subjectFocus(!0),this.autosizeTrigger.notifySubscribers(!0),this.modified=!1,this.isAppointmentButtonsVisible(this.appointment()&&this.selectedCalendarIsEditable()&&i.find(this.attendees(),(function(t){return t.email===e})))},A.prototype.changeCalendarColor=function(t){if(n.isFunction(this.calendars.getCalendarById)){var e=this.calendars.getCalendarById(t);e&&(this.calendarColor(""),this.calendarColor(e.color()))}},A.prototype.onIsTaskClick=function(){this.eventType("VTODO"===this.eventType()?"VEVENT":"VTODO")},A.prototype.onSaveClick=function(){if(""===this.subject())f.showPopup(v,[l.i18n("CALENDARWEBCLIENT/ERROR_SUBJECT_BLANK"),i.bind((function(){this.subjectFocus(!0)}),this)]);else{if(this.callbackSave){var t=h.pInt(this.repeatPeriod()),e="",s=null,n=0,a=r(this.getDateTime(this.startDom(),this.startTime())),o=r(this.getDateTime(this.endDom(),this.endTime())),c={calendarId:this.calendarId(),newCalendarId:this.selectedCalendarId(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:C.getTitleForEvent(this.subject(),this.description()),allDay:this.allDay(),location:this.location(),description:this.description(),alarms:this.getAlarmsArray(this.displayedAlarms()),attendees:this.attendees(),owner:this.owner(),modified:this.modified,type:this.eventType(),status:this.status(),withDate:this.withDate()},u=h.pInt(this.always());this.allDay()&&o.add(1,"days"),c.start=a,c.end=o,t&&(s=(e=this.repeatEndDom().datepicker("getDate"))?r(e).unix():null,n=this.repeatInterval(),t===Enums.CalendarRepeatPeriod.Daily&&u===Enums.CalendarAlways.Disable?c.rrule={byDays:[],count:null,end:2,interval:1,period:t,until:s,weekNum:null}:t===Enums.CalendarRepeatPeriod.Weekly&&u===Enums.CalendarAlways.Disable?(this.setDayOfWeek(),c.rrule={byDays:this.getDays(),count:null,end:2,interval:n,period:t,until:s,weekNum:null}):t===Enums.CalendarRepeatPeriod.Monthly||t===Enums.CalendarRepeatPeriod.Yearly?c.rrule={byDays:[],count:null,end:0,interval:1,period:t,until:null,weekNum:null}:t===Enums.CalendarRepeatPeriod.Daily&&u===Enums.CalendarAlways.Enable?c.rrule={byDays:[],count:null,end:3,interval:1,period:t,until:s,weekNum:null}:t===Enums.CalendarRepeatPeriod.Weekly&&u===Enums.CalendarAlways.Enable&&(this.setDayOfWeek(),c.rrule={byDays:this.getDays(),count:null,end:3,interval:n,period:t,until:s,weekNum:null})),this.callbackSave(c)}this.closePopup()}},A.prototype.onEscHandler=function(){this.dateEdit()?this.dateEdit(!1):this.closePopup()},A.prototype.onClose=function(){this.hideAll(),this.cleanAll()},A.prototype.hideAll=function(){this.dateEdit(!1),this.repeatEdit(!1),this.guestsEdit(!1)},A.prototype.cleanAll=function(){this.isTask()?this.withDate(!1):this.withDate(!0),this.isTask(!1),this.subject(""),this.description(""),this.location(""),this.isRepeat(!1),this.allDay(!1),this.repeatPeriod(Enums.CalendarRepeatPeriod.None),this.repeatInterval(1),this.repeatCount(null),this.repeatWeekNum(null),this.startDate(""),this.startTime(""),this.endDate(""),this.endTime(""),this.repeatEndDate(""),this.displayedAlarms([]),this.weekMO(!1),this.weekTU(!1),this.weekWE(!1),this.weekTH(!1),this.weekFR(!1),this.weekSA(!1),this.weekSU(!1),this.attendees([]),this.always(1),this.selectedCalendarId(""),this.attendees([])},A.prototype.onDeleteClick=function(){if(this.callbackDelete){var t={calendarId:this.selectedCalendarId(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:C.getTitleForEvent(this.subject(),this.description()),start:r(this.getDateTime(this.startDom(),this.startTime())),end:r(this.getDateTime(this.endDom(),this.endTime())),allDay:this.allDay(),location:this.location(),description:this.description()};this.callbackDelete(t)}this.closePopup()},A.prototype.showDates=function(t,e){e.stopPropagation(),this.dateEdit(!this.dateEdit())},A.prototype.showGuests=function(){if(this.attendees().length>0){var t=l.i18n("CALENDARWEBCLIENT/CONFIRM_REMOVE_ALL_ATTENDEES"),e=i.bind((function(t){t&&(this.guestsEdit(!1),this.guestEmailFocus(!1),this.attendees([]))}),this);f.showPopup(E,[t,e])}else this.guestsEdit(!this.guestsEdit()),this.guestEmailFocus(!this.guestEmailFocus())},A.prototype.onAddGuestClick=function(){var t=this.guestAutocompleteItem(),e=this.guestAutocomplete(),s=t||{name:"",email:e},n=i.any(this.attendees(),(function(t){return t.email===s.email}));""===s.email?m.showError(l.i18n("CALENDARWEBCLIENT/ERROR_EMAIL_BLANK")):s.email===this.owner()||n?this.recivedAnim(!0):this.attendees.push({status:0,name:s.name,email:s.email}),this.whomAnimate(s.email),this.guestAutocomplete(""),this.guestEmailFocus(!0)},A.prototype.populateAlarms=function(t){t?(this.alarmOptions(this.getDisplayedAlarms(i.union(this.defaultAlarms(),t))),this.displayedAlarms(this.getDisplayedAlarms(t))):this.alarmOptions(this.getDisplayedAlarms(this.defaultAlarms()))},A.prototype.getDisplayedAlarms=function(t){var e=[];return t&&i.each(t,(function(t,s){var i=this["alarm"+t]=a.observable(t),n="";i.subscribe((function(){this.disableAlarms(),this.modified=!0}),this),n=t>0&&t<60?l.i18n("COREWEBCLIENT/LABEL_MINUTES_PLURAL",{COUNT:t},null,t):t>=60&&t<1440?l.i18n("CALENDARWEBCLIENT/LABEL_HOURS_PLURAL",{COUNT:t/60},null,t/60):t>=1440&&t<10080?l.i18n("CALENDARWEBCLIENT/LABEL_DAYS_PLURAL",{COUNT:t/1440},null,t/1440):l.i18n("CALENDARWEBCLIENT/LABEL_WEEKS_PLURAL",{COUNT:t/10080},null,t/10080),e.push({value:t,alarm:i,text:n,isDisabled:!1})}),this),i.sortBy(e,(function(t){return t.value}))},A.prototype.getDisplayedPeriods=function(){return[{label:l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_NEVER"),value:0},{label:l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_DAILY"),value:1},{label:l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_WEEKLY"),value:2},{label:l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_MONTHLY"),value:3},{label:l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_YEARLY"),value:4}]},A.prototype.getAlarmsArray=function(t){var e=[];return i.each(t,(function(t,s){e.push(t.alarm())}),this),i.sortBy(e,(function(t){return-t}))},A.prototype.addFirstAlarm=function(){if(this.displayedAlarms().length){var t=l.i18n("CALENDARWEBCLIENT/CONFIRM_REMOVE_ALL_ALARMS"),e=i.bind((function(t){t&&this.displayedAlarms.removeAll()}),this);f.showPopup(E,[t,e])}else this.displayedAlarms(this.getDisplayedAlarms([this.alarmOptions()[0].value]))},A.prototype.addAlarm=function(){var t,e,s=0;e=i.sortBy(this.displayedAlarms(),(function(t){return t.alarm()})),i.each(e,(function(t){var e=t.alarm();5!==e&&s<=5?s=5:10!==e&&s<=10?s=10:15!==e&&s<=15?s=15:30!==e&&s<=30?s=30:1440!==e&&s<=1440&&(s=1440)})),t=this.getDisplayedAlarms([s])[0],this["alarm"+s]=a.observable(s),this.displayedAlarms.push(t)},A.prototype.removeAlarm=function(t){this.displayedAlarms.remove(t)},A.prototype.removeGuest=function(t){this.attendees.remove(t)},A.prototype.disableAlarms=function(){i.each(this.alarmOptions(),(function(t,e){t.isDisabled=i.any(this.displayedAlarms(),(function(e){return e.alarm()===t.value}))}),this),this.alarmOptions.valueHasMutated()},A.prototype.autocompleteCallback=function(t,e){var s=p.run("ContactsWebclient","getSuggestionsAutocompleteCallback",["all",this.owner()]);i.isFunction(s)&&(this.guestAutocompleteItem(null),s(t,e))},A.prototype.repeatRuleParse=function(t){var e=this.allEvents();this.repeatEndDom().datepicker("option","minDate",this.getDateTime(this.endDom())),t&&e===Enums.CalendarEditRecurrenceEvent.AllEvents&&(t.until&&this.repeatEndDom().datepicker("setDate",new Date(1e3*t.until)),t.byDays.length&&i.each(t.byDays,(function(t){this["week"+t](!0)}),this),this.repeatPeriod(t.period),this.repeatInterval(t.interval),this.repeatCount(t.count),this.repeatWeekNum(t.weekNum),this.always(3===t.end?1:0))},A.prototype.getDays=function(){var t=[];return this.weekMO()&&t.push("MO"),this.weekTU()&&t.push("TU"),this.weekWE()&&t.push("WE"),this.weekTH()&&t.push("TH"),this.weekFR()&&t.push("FR"),this.weekSA()&&t.push("SA"),this.weekSU()&&t.push("SU"),t},A.prototype.onMainPanelClick=function(){this.dateEdit()&&this.dateEdit(!1)},A.prototype.getDateWithoutYearIfMonthWord=function(t){var e=t.split(" "),s=r().format("YYYY");return 3===e.length&&s===e[2]?e[0]+" "+e[1]:t},A.prototype.setStartDate=function(t,e){e&&this.startDom().datepicker("setDate",t.toDate()),this.startDate(this.getDateWithoutYearIfMonthWord(n(this.startDom()).val())),this.yearlyDayText(l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_YEARLY_DAYMONTH",{DAYMONTH:t.format(this.getDateMonthFormat())})),this.monthlyDayText(l.i18n("CALENDARWEBCLIENT/LABEL_REPEAT_MONTHLY_DAY",{DAY:t.format("DD")}))},A.prototype.selectStartDate=function(){if(!this.lockSelectStartEndDate()&&this.startDate()&&this.endDate()){this.lockSelectStartEndDate(!0);var t=this.getDateTime(this.startDom(),this.startTime()),e=r(t),s=this.getDateTime(this.endDom(),this.endTime()),i=r(s);h.isNumber(this.iDiffInMinutes)&&(s=(i=e.clone().add(this.iDiffInMinutes,"minutes")).toDate(),this.setEndDate(i,!0),this.endTime(i.format(this.timeFormatMoment))),i.diff(e,"minutes")<0&&(this.setEndDate(e,!0),this.endTime(e.format(this.timeFormatMoment))),this.isEvOneDay(0===i.diff(e,"days")),this.isEvOneTime(0===i.diff(e,"minutes")),this.setStartDate(e,!1),this.startTime(e.format(this.timeFormatMoment)),this.lockSelectStartEndDate(!1)}},A.prototype.getDateMonthFormat=function(){var t=this.dateFormatMoment.slice(0,-5);return-1===n.inArray(t,["MM/DD","DD/MM","DD MMMM"])&&(t="MM/DD"),t},A.prototype.setEndDate=function(t,e){e&&this.endDom().datepicker("setDate",t.toDate()),this.endDate(this.getDateWithoutYearIfMonthWord(n(this.endDom()).val()))},A.prototype.selectEndDate=function(){if(!this.lockSelectStartEndDate()&&this.endDate()&&this.startDate()){this.lockSelectStartEndDate(!0);var t=this.getDateTime(this.startDom(),this.startTime()),e=r(t),s=this.getDateTime(this.endDom(),this.endTime()),i=r(s);this.iDiffInMinutes=i.diff(e,"minutes"),this.iDiffInMinutes<0&&(this.setStartDate(i,!0),this.startTime(i.format(this.timeFormatMoment)),this.iDiffInMinutes=0),this.isEvOneDay(0===i.diff(e,"days")),this.isEvOneTime(0===i.diff(e,"minutes")),this.setEndDate(i,!1),this.endTime(i.format(this.timeFormatMoment)),this.repeatEndDom().datepicker("option","minDate",s),this.isRepeat()||this.repeatEndDom().datepicker("setDate",i.add(7,"days").toDate()),this.lockSelectStartEndDate(!1)}},A.prototype.getDateTime=function(t,e){e=e?r(e,this.timeFormatMoment).format("HH:mm"):"";var s=t.datepicker("getDate"),i=e?e.split(":"):[];return 2===i.length&&null!==s&&(s.setHours(i[0]),s.setMinutes(i[1])),s},A.prototype.setActualTime=function(){if(!this.lockSelectStartEndDate()&&this.endDate()&&this.startDate()){this.lockSelectStartEndDate(!0);var t=r().format(this.timeFormatMoment),e=this.getDateTime(this.startDom(),t),s=r(e),i=this.getDateTime(this.endDom(),t),n=r(i);s.minutes()>30?(s.add(60-s.minutes(),"minutes"),n.add(90-n.minutes(),"minutes")):(s.add(30-s.minutes(),"minutes"),n.add(60-n.minutes(),"minutes")),this.iDiffInMinutes=n.diff(s,"minutes"),this.setStartDate(s,!0),this.startTime(s.format(this.timeFormatMoment)),this.setEndDate(n,!0),this.endTime(n.format(this.timeFormatMoment)),this.lockSelectStartEndDate(!1)}},A.prototype.onSetAppointmentActionResponse=function(t,e){t.Result||u.showErrorByCode(t,l.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},A.prototype.setAppointmentAction=function(t){var e=Enums.IcalConfigInt.NeedsAction,s=this.attendees(),a=d.getAttendee?d.getAttendee(this.attendees()):"",r=i.find(this.attendees(),(function(t){return t.email===a}),this),o=this.calendars.getCalendarById(this.selectedCalendarId()),l={AppointmentAction:t,CalendarId:this.selectedCalendarId(),EventId:this.uid(),Attendee:a};if(r){switch(t){case Enums.IcalConfig.Accepted:e=Enums.IcalConfigInt.Accepted,g.markIcalAccepted(this.uid());break;case Enums.IcalConfig.Tentative:e=Enums.IcalConfigInt.Tentative,g.markIcalTentative(this.uid());break;case Enums.IcalConfig.Declined:e=Enums.IcalConfigInt.Declined,g.markIcalNonexistent(this.uid())}k.send("SetAppointmentAction",l,this.onSetAppointmentActionResponse,this,"CalendarMeetingsPlugin"),r.status=e,this.attendees([]),this.attendees(s),this.setCurrentAttenderStatus(r.email,this.attendees()),t===Enums.IcalConfig.Declined&&o&&this.callbackAttendeeActionDecline&&n.isFunction(this.callbackAttendeeActionDecline)&&(this.callbackAttendeeActionDecline(o,this.id()),this.closePopup())}},A.prototype.editableSwitch=function(t,e,s){this.isEditable(t&&e||s),this.isEditableReminders(e)},A.prototype.setCurrentAttenderStatus=function(t,e){var s=i.find(e,(function(e){return e.email===t}));this.attenderStatus(s?s.status:0)},A.prototype.getAttenderTextStatus=function(t){switch(t){case 0:t=l.i18n("CALENDARWEBCLIENT/LABEL_ATTENDER_STATUS_PENDING");break;case 1:t=l.i18n("CALENDARWEBCLIENT/LABEL_ATTENDER_STATUS_ACCEPTED");break;case 2:t=l.i18n("CALENDARWEBCLIENT/LABEL_ATTENDER_STATUS_DECLINED");break;case 3:t=l.i18n("CALENDARWEBCLIENT/LABEL_ATTENDER_STATUS_TENTATIVE")}return t},A.prototype.setDayOfWeek=function(){if(this.repeatPeriod()===Enums.CalendarRepeatPeriod.Weekly&&!this.getDays().length)switch(this.getDateTime(this.startDom()).getUTCDay()){case 0:this.weekMO(!0);break;case 1:this.weekTU(!0);break;case 2:this.weekWE(!0);break;case 3:this.weekTH(!0);break;case 4:this.weekFR(!0);break;case 5:this.weekSA(!0);break;case 6:this.weekSU(!0)}},A.prototype.switchTask=function(t){this.isTask(t)},t.exports=new A},"7WqE":function(t,e,s){"use strict";var i=s("F/us"),n=s("0h2I"),a=s("wd/R"),r=s("AFLV"),o=s("ZP6a"),l=s("IAk5"),h=s("gcBV"),c=s("aM42"),u=s("tqo6");function d(){this.id=0,this.sSyncToken="",this.name=n.observable(""),this.description=n.observable(""),this.owner=n.observable(""),this.isDefault=!1,this.isShared=n.observable(!1),this.isSharedToAll=n.observable(!1),this.sharedToAllAccess=Enums.CalendarAccess.Read,this.isPublic=n.observable(!1),this.url=n.observable(""),this.davUrl=n.observable(""),this.exportUrl=n.observable(""),this.pubUrl=n.observable(""),this.shares=n.observableArray([]),this.events=n.observableArray([]),this.eventsCount=n.computed((function(){return this.events().length}),this),this.access=n.observable(Enums.CalendarAccess.Write),this.color=n.observable(""),this.color.subscribe((function(){this.events(i.map(this.events(),(function(t){return t.backgroundColor=t.borderColor=this.color(),t}),this)),this.name.valueHasMutated()}),this),this.active=n.observable(!0),this.startDateTime=0,this.endDateTime=0,this.canShare=n.computed((function(){return!this.isShared()||this.isShared()&&this.access()===Enums.CalendarAccess.Write&&0!==this.shares().length||this.isOwner()}),this),this.bAllowShare=u.AllowShare,this.bAllowAppointments=u.AllowAppointments}d.prototype.parseCssColor=function(t){var e=r.pString(t);return e.length>7?e=e.substr(0,7):e.length>4&&e.length<7&&(e=e.substr(0,4)),4===e.length&&(e=e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.match(/^#[A-Fa-f0-9]{6}$/i)||(e="#f09650"),e},d.prototype.parse=function(t){this.id=r.pString(t.Id),this.sSyncToken=t.SyncToken,this.name(r.pString(t.Name)),this.description(r.pString(t.Description)),this.owner(r.pString(t.Owner)),this.active(!h.hasData(this.id)||h.getData(this.id)),this.isDefault=!!t.IsDefault,this.isShared(!!t.Shared),this.isSharedToAll(!!t.SharedToAll),this.sharedToAllAccess=t.SharedToAllAccess,this.isPublic(!!t.IsPublic),this.access(t.Access),this.color(this.parseCssColor(t.Color)),this.url(r.pString(t.Url)),this.exportUrl(o.getAppPath()+"?calendar-download/"+r.pString(t.ExportHash)),this.pubUrl(o.getAppPath()+"?calendar-pub="+r.pString(t.PubHash)),this.shares(t.Shares||[]),i.each(t.Events,(function(t){this.addEvent(t)}),this)},d.prototype.updateEvent=function(t){return t&&(this.removeEvent(t.id),this.addEvent(t)),!1},d.prototype.addEvent=function(t){t&&!this.eventExists(t.id)&&this.events.push(this.parseEvent(t))},d.prototype.getEvent=function(t){return i.find(this.events(),(function(e){return e.id===t}),this)},d.prototype.eventExists=function(t){return!!this.getEvent(t)},d.prototype.getEvents=function(t,e){return i.filter(this.events(),(function(s){var i=t.unix(),n=e.unix(),r=a.utc(s.start).unix(),o=a.utc(s.end).unix();return r>=i&&o<=n||r<=i&&o>=n||r>=i&&r<=n||o<=n&&o>=i}),this)||[]},d.prototype.removeEvent=function(t){this.events(i.filter(this.events(),(function(e){return e.id!==t}),this))},d.prototype.removeEventByUid=function(t,e){this.events(i.filter(this.events(),(function(s){return!(s.uid===t||e&&s.excluded)}),this))},d.prototype.removeEvents=function(){this.events([])},d.prototype.expungeEvents=function(t,e,s,n){var r=[];i.each(this.getEvents(a.unix(e),a.unix(s)),(function(e){i.include(t,e.id)||e.type!==n||r.push(e.id)}),this),this.events(i.filter(this.events(),(function(t){return!i.include(r,t.id)}),this))},d.prototype.isEditable=function(){return this.access()!==Enums.CalendarAccess.Read},d.prototype.isOwner=function(){return l.getUserPublicId()===this.owner()},d.prototype.parseEvent=function(t){if(t.title=c.getTitleForEvent(t.subject,t.description),t.editable=!t.appointment,t.backgroundColor=t.borderColor=this.color(),!i.isArray(t.className)){var e=t.className;t.className=[e]}return this.access()===Enums.CalendarAccess.Read?(t.className.push("fc-event-readonly"),t.editable=!1):t.className=i.filter(t.className,(function(t){return"fc-event-readonly"!==t})),t.rrule&&!t.excluded?t.className.push("fc-event-repeat"):t.className=i.filter(t.className,(function(t){return"fc-event-repeat"!==t})),r.isNonEmptyArray(t.attendees)&&this.bAllowAppointments?t.className.push("fc-event-appointment"):t.className=i.filter(t.className,(function(t){return"fc-event-appointment"!==t})),t},d.prototype.reloadEvents=function(){this.events(i.map(this.events(),(function(t){return this.parseEvent(t)}),this))},t.exports=d},"Ig+v":function(t,e,s){var i=s("0h2I"),n=s("QaF5");function a(t){this.sName="",this.visible=i.observable(!0),this.baseHash=i.observable(""),this.hash=i.observable(""),this.linkText=i.observable(t),this.isCurrent=i.observable(!1),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.unseenCount=i.observable(0),this.allowChangeTitle=i.observable(!1),this.inactiveTitle=i.observable(""),this.excludedHashes=i.observableArray([])}a.prototype.ViewTemplate="CoreWebclient_HeaderItemView",a.prototype.setName=function(t){this.sName=t.toLowerCase(),""===this.baseHash()?(this.hash(n.buildHashFromArray([t.toLowerCase()])),this.baseHash(this.hash())):this.hash(this.baseHash())},t.exports=a},KA8O:function(t,e,s){"use strict";var i=s("o0Bx"),n=s("tqo6");i.registerAbortRequestHandler(n.ServerModuleName,(function(t,e){switch(t.Method){case"UpdateEvent":var s=t.Parameters,i=e.Parameters;return"UpdateEvent"===e.Method&&i.calendarId===s.calendarId&&i.uid===s.uid;case"GetCalendars":return"GetCalendars"===e.Method;case"GetEvents":return"GetEvents"===e.Method}return!1})),t.exports={send:function(t,e,s,a,r){i.send(r||n.ServerModuleName,t,e,s,a)}}},PMX0:function(t,e,s){"use strict";var i=s("F/us"),n=s("wd/R"),a={getTimeListStepHalfHour:function(t){return i.map(["00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30","04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"],(function(e){var s=n(e,"HH:mm").format(t);return{text:s,value:s}}))},getDateFormatForDatePicker:function(t){var e="mm/dd/yy";switch(t){case"MM/DD/YYYY":e="mm/dd/yy";break;case"DD/MM/YYYY":e="dd/mm/yy";break;case"DD Month YYYY":e="dd MM yy"}return e}};t.exports=a},XdVW:function(t,e,s){"use strict";var i=s("F/us"),n=s("0h2I"),a=s("gcBV"),r=s("7WqE");function o(t){this.parentOnCalendarActiveChange=t.onCalendarActiveChange,this.parentOnCalendarCollectionChange=t.onCalendarCollectionChange,this.defaultCal=n.observable(null),this.currentCal=n.observable(null),this.collection=n.observableArray([]),this.collection.subscribe((function(){this.pickCurrentCalendar(this.defaultCal()),this.parentOnCalendarCollectionChange&&this.parentOnCalendarCollectionChange()}),this),this.count=n.computed((function(){return this.collection().length}),this),this.own=n.computed((function(){return i.filter(this.collection(),(function(t){return!t.isShared()}))}),this),this.ownCount=n.computed((function(){return this.own().length}),this),this.shared=n.computed((function(){return i.filter(this.collection(),(function(t){return t.isShared()&&!t.isSharedToAll()}))}),this),this.sharedCount=n.computed((function(){return this.shared().length}),this),this.sharedToAll=n.computed((function(){return i.filter(this.collection(),(function(t){return t.isShared()&&t.isSharedToAll()}))}),this),this.sharedToAllCount=n.computed((function(){return this.sharedToAll().length}),this),this.ids=n.computed((function(){return i.map(this.collection(),(function(t){return t.id}),this)}),this)}o.prototype.pickCurrentCalendar=function(t){var e=i.find(this.collection(),(function(t){return t.active()&&t.isEditable()}),this);this.currentCal()&&this.currentCal().active()||(t&&t.active()&&t.isEditable()?this.currentCal(t):this.defaultCal()&&(this.defaultCal().active()&&this.defaultCal().isEditable()||!e)?this.currentCal(this.defaultCal()):e&&this.currentCal(e))},o.prototype.getCalendarById=function(t){return i.find(this.collection(),(function(e){return e.id===t}),this)},o.prototype.getEvents=function(t,e){var s=[],n=[];return i.each(this.collection(),(function(a){a&&a.active()&&(n=t&&e?a.getEvents(t,e):a.events(),s=i.union(s,n))}),this),s},o.prototype.parseCalendar=function(t){var e=new r;return e.parse(t),e},o.prototype.parseAndAddCalendar=function(t){var e,s=null,i=this.parseCalendar(t);return i.active.subscribe((function(t){this.parentOnCalendarActiveChange(i);var e=i.active()?i:this.defaultCal();this.pickCurrentCalendar(e),a.setData(i.id,t)}),this),i.isDefault&&this.defaultCal(i),(e=this.calendarExists(i.id))||0===e?(s=this.getCalendarById(i.id),i.events(s.events()),this.collection.splice(e,1,i)):this.collection.push(i),i},o.prototype.calendarExists=function(t){var e=i.indexOf(i.map(this.collection(),(function(t){return t.id})),t);return!(e<0)&&e},o.prototype.removeCalendar=function(t){this.collection(i.filter(this.collection(),(function(e){return e.id!==t}),this))},o.prototype.clearCollection=function(){this.collection.removeAll()},o.prototype.getColors=function(){return i.map(this.collection(),(function(t){return t.color().toLowerCase()}),this)},o.prototype.setDefault=function(t){i.each(this.collection(),(function(e){e.id!==t?(e.isDefault=!0,this.defaultCal(e)):e.isDefault=!1}),this)},o.prototype.sort=function(){var t=i.sortBy(this.collection(),(function(t){return t.name()}));this.collection(i.sortBy(t,(function(t){return t.isShared()})))},o.prototype.expunge=function(t){this.collection(i.filter(this.collection(),(function(e){return i.include(t,e.id)}),this))},t.exports=o},aM42:function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("wd/R"),r=s("PMX0"),o=s("tqo6");r.getTimeListStepHour=function(t){return i.map(["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","00:00"],(function(e){var s=a(e,"HH:mm"),i=s.format(t),n=s.format("H");return"00:00"===e&&(n="24"),{text:i,value:n}}))},r.getTitleForEvent=function(t,e){if(o.AddDescriptionToTitle)return n.trim((t+" "+e).replace(/[\n\r]/g," "));var s=t?n.trim(t.replace(/[\n\r]/," ")):"",i=s.indexOf(" ",180);return i>=0&&(s=s.substring(0,i)+"..."),s.length>200&&(s=s.substring(0,200)+"..."),s},t.exports=r},bvYb:function(t,e,s){"use strict";t.exports=function(t){var e=s("IAk5"),i=s("OgeD");if(e.isUserNormalOrTenant()&&i.isModuleEnabled("CalendarWebclient")){var n=s("RN+F"),a=null;return{getScreens:function(){var t={tasks:function(){return s("tbLT")}};return t},getHeaderItem:function(){if(null===a){var t=s("Ig+v");a=new t(n.i18n("TASKS/ACTION_SHOW_TASKS"))}return{item:a,name:"tasks"}}}}return null}},fIp0:function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("0h2I"),r=s("Yjhd"),o=s("IAk5");function l(t,e){this.bShown=!1,this.currentPage=a.observable(1),this.count=a.observable(t),this.perPage=a.observable(e),this.firstPage=a.observable(1),this.lastPage=a.observable(1),this.pagesCount=a.computed((function(){var t=this.perPage()>0?Math.ceil(this.count()/this.perPage()):0;return t>0?t:1}),this),a.computed((function(){var t=20,e=4,s=this.pagesCount(),i=this.currentPage(),n=i,a=i;if(s>1)for(;t--,1<n&&(n--,e--),0!==e&&(s>a&&(a++,e--),0!==e)&&0!==t;);this.firstPage(n),this.lastPage(a)}),this),this.visibleFirst=a.computed((function(){return this.firstPage()>1}),this),this.visibleLast=a.computed((function(){return this.lastPage()<this.pagesCount()}),this),this.clickPage=i.bind(this.clickPage,this),this.pages=a.computed((function(){var t=this.firstPage(),e=[];if(this.firstPage()<this.lastPage())for(;t<=this.lastPage();t++)e.push({number:t,current:t===this.currentPage(),clickFunc:this.clickPage});return e}),this),o.isMobile()||this.hotKeysBind()}l.prototype.ViewTemplate="CoreWebclient_PageSwitcherView",l.prototype.hotKeysBind=function(){n(document).on("keydown",n.proxy((function(t){if(this.bShown&&!r.isTextFieldFocused()){var e=t.keyCode;t.ctrlKey&&e===Enums.Key.Left?this.clickPreviousPage():t.ctrlKey&&e===Enums.Key.Right&&this.clickNextPage()}}),this))},l.prototype.hide=function(){this.bShown=!1},l.prototype.show=function(){this.bShown=!0},l.prototype.clear=function(){this.currentPage(1),this.count(0)},l.prototype.setCount=function(t){this.count(t),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},l.prototype.setPage=function(t,e){this.perPage(e),t>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(t)},l.prototype.clickPage=function(t){var e=t.number;e<1&&(e=1),e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},l.prototype.clickFirstPage=function(){this.currentPage(1)},l.prototype.clickPreviousPage=function(){var t=this.currentPage()-1;t<1&&(t=1),this.currentPage(t)},l.prototype.clickNextPage=function(){var t=this.currentPage()+1;t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},l.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},t.exports=l},gcGb:function(t,e,s){"use strict";var i=s("0h2I"),n=s("F/us"),a=s("IAk5"),r=s("KA8O");function o(){this.calendars=i.observableArray([]),this.calendarsLoadingStarted=i.observable(!1),this.icalAttachments=[],this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.calendarSettingsChanged=i.observable(!1),this.calendarChanged=i.observable(!1)}o.prototype.addIcal=function(t){n.each(this.icalAttachments,(function(e){e.uid()===t.uid()&&(t.sSequence>=e.sSequence?e.lastModification(!1):t.lastModification(!1))})),this.icalAttachments.push(t),0===this.calendars().length&&this.requestCalendarList()},o.prototype.getIcal=function(t){return n.find(this.icalAttachments,(function(e){return t===e.file()}))},o.prototype.onGetCalendarsResponse=function(t,e){if(t&&t.Result&&t.Result.Calendars){var s=a.currentAccountEmail?a.currentAccountEmail():"",i=n.filter(t.Result.Calendars,(function(t){return t.Owner===s||t.Access===Enums.CalendarAccess.Full||t.Access===Enums.CalendarAccess.Write}));this.calendars(n.map(i,(function(t){return{name:t.Name+" <"+t.Owner+">",id:t.Id}})))}this.calendarsLoadingStarted(!1)},o.prototype.requestCalendarList=function(){this.calendarsLoadingStarted()||(r.send("GetCalendars",null,this.onGetCalendarsResponse,this),this.calendarsLoadingStarted(!0))},o.prototype.markIcalTypeByFile=function(t,e,s,i,a,r){n.each(this.icalAttachments,(function(n){t===n.file()&&(n.type(e),n.cancelDecision(s),n.replyDecision(i),n.calendarId(a),n.selectedCalendarId(r))}))},o.prototype.markIcalNonexistent=function(t){n.each(this.icalAttachments,(function(e){t===e.uid()&&e.markNeededAction()}))},o.prototype.markIcalNotSaved=function(t){n.each(this.icalAttachments,(function(e){t===e.uid()&&e.markNotSaved()}))},o.prototype.markIcalTentative=function(t){n.each(this.icalAttachments,(function(e){t===e.uid()&&e.markTentative()}))},o.prototype.markIcalAccepted=function(t){n.each(this.icalAttachments,(function(e){t===e.uid()&&e.markAccepted()}))},t.exports=new o},kwPS:function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("0h2I"),r=s("AFLV"),o=s("Yjhd"),l=s("IAk5"),h=s("HLSX"),c=s("76Kh");function u(t,e,s,o,h,c,u,d,p,m,b){this.fSelectCallback=e||function(){},this.fDeleteCallback=s||function(){},this.fDblClickCallback=!l.isMobile()&&o?o:function(){},this.fEnterCallback=h||function(){},this.bResetCheckedOnClick=!!u,this.bCheckOnSelect=!!d,this.bUnselectOnCtrl=!!p,this.bDisableMultiplySelection=!!m,this.bChangeOnSelect=void 0===b||!!b,this.useKeyboardKeys=a.observable(!1),this.list=a.observableArray([]),t&&t.subscribe&&t.subscribe((function(t){this.list(t)}),this),this.multiplyLineFactor=c,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Up,this.KeyRight=Enums.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe((function(t){this.iFactor=0<t?t:1}),this):this.iFactor=r.pInt(this.multiplyLineFactor),this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Left,this.KeyRight=Enums.Key.Right,n("html").hasClass("rtl")&&(this.KeyLeft=Enums.Key.Right,this.KeyRight=Enums.Key.Left)),this.sActionSelector="",this.sSelectableSelector="",this.sCheckboxSelector="";var f=this;this.listChecked=a.computed({read:function(){return i.filter(this.list(),(function(t){var e=t&&t.checked&&t.checked(),s=t&&t.selected&&t.selected();return e||f.bCheckOnSelect&&s}))},write:function(t){t=!!t,i.each(this.list(),(function(e){e.checked(t)})),this.list.valueHasMutated()},owner:this}),this.checkAll=a.computed({read:function(){return 0<this.listChecked().length},write:function(t){this.listChecked(!!t)},owner:this}),this.selectorHook=a.observable(null),this.selectorHook.subscribe((function(){var t=this.selectorHook();t&&i.isFunction(t.selected)&&t.selected(!1)}),this,"beforeChange"),this.selectorHook.subscribe((function(t){t&&t.selected(!0)}),this),this.itemSelected=a.computed({read:this.selectorHook,write:function(t){this.selectorHook(t),t&&(f.scrollToSelected(),this.oLast=t)},owner:this}),this.list.subscribe((function(t){if(i.isArray(t)){var e=this.itemSelected();e&&(i.find(t,(function(t){return e===t}))||this.itemSelected(null))}else this.itemSelected(null)}),this),this.listCheckedOrSelected=a.computed({read:function(){var t=this.itemSelected(),e=this.listChecked();return 0<e.length?e:t?[t]:[]},write:function(t){t?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=a.computed({read:function(){var t=[],e=this.itemSelected(),s=this.listChecked();return s&&(t=s.slice(0)),e&&-1===i.indexOf(s,e)&&t.push(e),t},write:function(t){t?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=a.computed((function(){var t=this.list().length,e=this.listChecked().length;return 0<t&&0<e&&t>e}),this),this.onKeydownBound=i.bind(this.onKeydown,this)}u.prototype.iTimer=0,u.prototype.bResetCheckedOnClick=!1,u.prototype.bCheckOnSelect=!1,u.prototype.bUnselectOnCtrl=!1,u.prototype.bDisableMultiplySelection=!1,u.prototype.getLastOrSelected=function(){var t=0,e=null;return i.each(this.list(),(function(s){s.checked()&&t++,s.selected()&&(e=s)})),0===t&&e?e:this.oLast},u.prototype.initOnApplyBindings=function(t,e,s,i,r){n(document).on("keydown",this.onKeydownBound),this.oListScope=i,this.oScrollScope=r,this.sActionSelector=t,this.sSelectableSelector=e,this.sCheckboxSelector=s;var o=this,l=function(t,e,s){var i=0,n=0,a=null,r=!1,l=!1,h=[],c=!1;if(e=e||null,s&&s.shiftKey&&null!==e&&null!==t&&e!==t)for(h=o.list(),c=e.checked(),i=0,n=h.length;i<n;i++)r=!1,(a=h[i])!==t&&a!==e||(r=!0),r&&(l=!l),(l||r)&&a.checked(c);e&&(o.oLast=e)};n(this.oListScope).on("dblclick",t,(function(t){var e=a.dataFor(this);!e||!t||t.ctrlKey||t.altKey||t.shiftKey||o.onDblClick(e)})),h.mobileDevice&&n(this.oListScope).on("touchstart",t,(function(t){if(t){var e=t.timeStamp,s=e-(n(this).data("lastTouch")||e),i=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches.length:0;n(this).data("lastTouch",e),!s||s>250||i>1||(t.preventDefault(),n(this).trigger("dblclick"))}})),n(this.oListScope).on("click",t,(function(t){var e=!0,s=null,i=o.getLastOrSelected(),n=a.dataFor(this);n&&t&&(t.shiftKey?(e=!1,o.bDisableMultiplySelection||(null===o.oLast&&(o.oLast=n),n.checked(!n.checked()),l(i,n,t))):t.ctrlKey&&(e=!1,o.bDisableMultiplySelection||(o.oLast=n,!(s=o.itemSelected())||s.checked()||n.checked()||s.checked(!0),o.bUnselectOnCtrl&&n===o.itemSelected()?(n.checked(!n.selected()),o.itemSelected(null)):n.checked(!n.checked()))),e&&o.selectionFunc(n))})),n(this.oListScope).on("click",s,(function(t){var e=a.dataFor(this);e&&t&&!o.bDisableMultiplySelection&&(t.shiftKey?(null===o.oLast&&(o.oLast=e),l(o.getLastOrSelected(),e,t)):o.oLast=e),t&&t.stopPropagation&&t.stopPropagation()})),n(this.oListScope).on("dblclick",s,(function(t){t&&t.stopPropagation&&t.stopPropagation()}))},u.prototype.getResultSelection=function(t,e){var s=this,a=!1,r=!1,o=null,l=this.iFactor,h=!!this.multiplyLineFactor,c=0,u=0,d=[];if(!t&&-1<n.inArray(e,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]))(d=this.list())&&0<d.length&&(-1<n.inArray(e,[this.KeyDown,this.KeyRight,Enums.Key.PageUp,Enums.Key.Home])?o=d[0]:-1<n.inArray(e,[this.KeyUp,this.KeyLeft,Enums.Key.PageDown,Enums.Key.End])&&(o=d[d.length-1]));else if(t&&0<(u=(d=this.list())?d.length:0))if(Enums.Key.Home===e||Enums.Key.PageUp===e||Enums.Key.End===e||Enums.Key.PageDown===e||h&&(Enums.Key.Left===e||Enums.Key.Right===e)||!h&&(Enums.Key.Up===e||Enums.Key.Down===e))i.each(d,(function(i){if(!a)switch(e){case s.KeyUp:case s.KeyLeft:t===i?a=!0:o=i;break;case Enums.Key.Home:case Enums.Key.PageUp:o=i,a=!0;break;case s.KeyDown:case s.KeyRight:r?(o=i,a=!0):t===i&&(r=!0);break;case Enums.Key.End:case Enums.Key.PageDown:o=i}}));else if(h&&this.KeyDown===e){for(;c<u;c++)if(t===d[c]){u-1<(c+=l)&&(c-=l),o=d[c];break}}else if(h&&this.KeyUp===e)for(c=u;c>=0;c--)if(t===d[c]){0>(c-=l)&&(c+=l),o=d[c];break}return o},u.prototype.shiftClickResult=function(t,e,s){if(e){var a=!!this.multiplyLineFactor,r=!1,o=!1;-1<n.inArray(s,a?[Enums.Key.Left,Enums.Key.Right]:[Enums.Key.Up,Enums.Key.Down])?e.checked(!e.checked()):-1<n.inArray(s,a?[Enums.Key.Up,Enums.Key.Down,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]:[Enums.Key.Left,Enums.Key.Right,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&(o=!e.checked(),i.each(this.list(),(function(s){var i=!1;s!==t&&e!==s||(r=!r,i=!0),(r||i)&&(s.checked(o),i=!1)})),a&&t&&(s===Enums.Key.Up||s===Enums.Key.Down)&&t.checked(!t.checked()))}},u.prototype.clickNewSelectPosition=function(t,e){var s=this.itemSelected(),i=this.getResultSelection(s,t);i&&(e&&this.shiftClickResult(i,s,t),this.selectionFunc(i))},u.prototype.onKeydown=function(t){var e=!0,s=0;return this.useKeyboardKeys()&&t&&!o.isTextFieldFocused()&&!c.hasOpenedMaximizedPopups()&&(s=t.keyCode,t.ctrlKey||this.KeyUp!==s&&this.KeyDown!==s&&this.KeyLeft!==s&&this.KeyRight!==s&&Enums.Key.PageUp!==s&&Enums.Key.PageDown!==s&&Enums.Key.Home!==s&&Enums.Key.End!==s?Enums.Key.Del!==s||t.ctrlKey||t.shiftKey?Enums.Key.Enter===s?0<this.list().length&&!t.ctrlKey&&(this.onEnter(this.itemSelected()),e=!1):!t.ctrlKey||t.altKey||t.shiftKey||Enums.Key.a!==s||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),e=!1):0<this.list().length&&(this.onDelete(),e=!1):(this.clickNewSelectPosition(s,t.shiftKey),e=!1)),e},u.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},u.prototype.onEnter=function(t){t&&this.fEnterCallback.call(this,t)},u.prototype.selectionFunc=function(t){this.bChangeOnSelect&&this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.bChangeOnSelect&&this.itemSelected(t),this.fSelectCallback.call(this,t)},u.prototype.onDblClick=function(t){this.fDblClickCallback.call(this,t)},u.prototype.koCheckAll=function(){return a.computed({read:this.checkAll,write:this.checkAll,owner:this})},u.prototype.koCheckAllIncomplete=function(){return a.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},u.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var t=n(this.sSelectableSelector,this.oScrollScope),e=t.position(),s=this.oScrollScope.height(),i=this.oScrollScope.scrollTop(),a=t.outerHeight(),r=e&&e.top>=i&&e.top<=i+s-a;return!(!e||r)&&(e.top<i+s&&e.top+a>i+s?this.oScrollScope.scrollTop(e.top+a+20-s):this.oScrollScope.scrollTop(e.top-20),!0)},t.exports=u},nKlx:function(t,e,s){"use strict";var i=s("RN+F"),n={getMonthNamesArray:function(){for(var t=i.i18n("COREWEBCLIENT/LIST_MONTH_NAMES").split(" "),e=t.length;e<12;e++)t[e]="";return t},daysInMonth:function(t,e){return 0<t&&13>t&&0<e?new Date(e,t,0).getDate():31}};t.exports=n},tbLT:function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("0h2I"),r=s("wd/R"),o=s("RN+F"),l=s("AFLV"),h=s("Yjhd"),c=s("o0Bx"),u=s("JFZZ"),d=s("xcwT"),p=s("kwPS"),m=s("fIp0"),b=s("76Kh"),f=s("hPb3"),y=s("XdVW"),v=(s("7WqE"),s("1xZj"));function E(){this.sDateFormat=f.dateFormat(),this.dateFormatMoment=h.getDateFormatForMoment(this.sDateFormat),this.saveCommand=h.createCommand(this,this.executeSave),this.removeCommand=h.createCommand(this,this.executeRemove),this.calendars=new y({onCalendarCollectionChange:function(){},onCalendarActiveChange:function(){}}),d.call(this,"Tasks"),this.iItemsPerPage=20,this.browserTitle=a.observable(o.i18n("TASKS/HEADING_BROWSER_TAB")),this.tasksList=a.observableArray([]),this.hiddenTasksList=a.observableArray([]),this.selectedItem=a.observable(null),this.isSearchFocused=a.observable(!1),this.searchInput=a.observable(""),this.selector=new p(this.tasksList,i.bind(this.viewItem,this),this.executeRemove,i.bind(this.taskClickCallback,this)),this.searchClick=a.observable(!1),this.isSearch=a.computed((function(){return""!==this.searchInput()&&this.searchClick()}),this),this.pageSwitcherLocked=a.observable(!1),this.oPageSwitcher=new m(0,this.iItemsPerPage),this.oPageSwitcher.currentPage.subscribe((function(t){this.currentPage(t),this.getTasks()}),this),this.currentPage=a.observable(1),this.loadingList=a.observable(!1),this.preLoadingList=a.observable(!1),this.loadingList.subscribe((function(t){this.preLoadingList(t)}),this),this.sTimeFormat=a.computed((function(){return f.timeFormat()===Enums.TimeFormat.F24?"HH:mm":"hh:mm A"}),this),this.isEmptyList=a.computed((function(){return 0===this.tasksList().length}),this),this.searchText=a.observable(""),this.showCompleted=a.observable(!1),this.actionCompletedText=a.computed((function(){return this.showCompleted()?o.i18n("TASKS/ACTION_HIDE_COMPLETED"):o.i18n("TASKS/ACTION_SHOW_COMPLETED")}),this)}s("Vn+K"),i.extendOwn(E.prototype,d.prototype),E.prototype.ViewTemplate="Tasks_MainView",E.prototype.ViewConstructorName="CMainView",E.prototype.onShow=function(){this.getCalendars()},E.prototype.getCalendars=function(){this.loadingList(!0),c.send("Calendar","GetCalendars",{IsPublic:!1},this.onGetCalendarsResponse,this)},E.prototype.onGetCalendarsResponse=function(t,e){var s=[],n=[],a=null,r=null,o=this;t.Result&&(i.each(t.Result.Calendars,(function(e){if(!(a=this.calendars.parseCalendar(e)).isShared()&&(s.push(a.id),r=this.calendars.getCalendarById(a.id),(this.needsToReload||(r&&r.sSyncToken)!==(a&&a.sSyncToken))&&(a=this.calendars.parseAndAddCalendar(e)))){var h=a.id;a.active.subscribe((function(t){i.each(o.tasksList(),(function(e){e.calendarId===h&&e.visible(t)}))}),a),a.davUrl(l.pString(t.Result.ServerUrl)),n.push(a.id)}}),this),this.calendars.expunge(s),this.getTasks(s))},E.prototype.getTasks=function(t){this.loadingList(!0),c.send("Calendar","GetTasks",{CalendarIds:t,Completed:this.showCompleted(),Search:this.searchInput()},this.onGetTasksResponse,this)},E.prototype.prepareTask=function(t){var e=this,s=e.calendars.getCalendarById(t.calendarId);if(t.visibleDate=a.observable(""),t.withDate=a.observable(!1),t.start&&t.end){t.withDate(!0),t.start=r(t.start),t.end=r(t.end);var i=t.start.clone(),n=t.end.clone();n&&t.allDay&&n.subtract(1,"days");var o=0===n.diff(i,"days"),l=0===n.diff(i,"minutes"),h=e.getDateWithoutYearIfMonthWord(i.format(e.dateFormatMoment)),c=o?"":" - "+e.getDateWithoutYearIfMonthWord(n.format(e.dateFormatMoment)),u=t.allDay?"":", "+i.format(this.sTimeFormat()),d=t.allDay||l?"":(o?" - ":", ")+n.format(this.sTimeFormat());t.visibleDate=a.observable(h+u+c+d)}return t.selected=a.observable(!1),t.checked=a.observable(t.status),t.visible=a.observable(s.active()),t.color=s.color,t.checked.subscribe((function(s){e.updateTaskStatus(t)})),t},E.prototype.getTaskFromList=function(t){return i.find(this.tasksList(),(function(e){return e.uid===t}))},E.prototype.onGetTasksResponse=function(t){var e=t.Result,s=this;if(e){var n=l.isNonEmptyArray(e)?i.compact(i.map(e,(function(t){return s.prepareTask(t)}))):[];this.tasksList(n),this.sortTasksList(),this.loadingList(!1)}},E.prototype.viewItem=function(t){this.selectedItem(t)},E.prototype.onBind=function(){this.selector.initOnApplyBindings(".sales_sub_list .item",".sales_sub_list .selected.item",".sales_sub_list .selected.item",n(".sales_list",this.$viewDom),n(".sales_list_scroll.scroll-inner",this.$viewDom))},E.prototype.searchSubmit=function(){""!==this.searchInput()?this.searchText(o.i18n("TASKS/INFO_SEARCH_RESULT",{SEARCH:this.searchInput()})):this.searchText(""),this.searchClick(!0),this.tasksList([]),this.getCalendars()},E.prototype.onClearSearchClick=function(){this.searchInput(""),this.searchText(""),this.searchClick(!1),this.searchSubmit()},E.prototype.createTaskInCurrentCalendar=function(){this.calendars.pickCurrentCalendar(),this.createTaskToday(this.calendars.currentCal())},E.prototype.createTaskToday=function(t){this.openTaskPopup(t,null,null,!1)},E.prototype.openTaskPopup=function(t,e,s,n){t&&b.showPopup(v,[{CallbackSave:i.bind(this.createTask,this),CallbackDelete:null,Calendars:this.calendars,SelectedCalendar:t?t.id:0,Start:e,End:s,AllDay:n,TimeFormat:this.sTimeFormat(),DateFormat:f.dateFormat(),Type:"VTODO",IsTaskApp:!0}])},E.prototype.getParamsFromEventData=function(t){return{id:t.id,uid:t.uid,calendarId:t.calendarId,newCalendarId:t.newCalendarId||t.calendarId,subject:t.subject,allDay:t.allDay?1:0,location:t.location,description:t.description,alarms:t.alarms?JSON.stringify(t.alarms):"[]",attendees:t.attendees?JSON.stringify(t.attendees):"[]",owner:t.owner,recurrenceId:t.recurrenceId,excluded:t.excluded,allEvents:t.allEvents,modified:t.modified?1:0,start:t.start.local().toDate(),end:t.end.local().toDate(),startTS:t.start.unix(),endTS:(t.end,t.end.unix()),rrule:t.rrule?JSON.stringify(t.rrule):null,type:t.type,status:t.status,withDate:t.withDate}},E.prototype.createTask=function(t){var e=this.getParamsFromEventData(t);e.calendarId=t.newCalendarId,c.send("Calendar","CreateEvent",e,this.onCreateTaskResponse,this)},E.prototype.sortTasksList=function(){this.tasksList.sort((function(t,e){return null!==t.startTS&&null!==e.startTS?t.startTS===e.startTS?0:t.startTS>e.startTS?1:-1:null===t.startTS&&null===e.startTS?t.lastModified===e.lastModified?0:t.lastModified>e.lastModified?1:-1:null===t.startTS?1:null===e.startTS?-1:void 0}))},E.prototype.onCreateTaskResponse=function(t){var e=t.Result;if(e){var s=this.prepareTask(e.Events[0]);this.tasksList.push(s),this.sortTasksList()}else u.showErrorByCode(t)},E.prototype.taskClickCallback=function(t){i.bind((function(e){var s={ID:t.id,Uid:t.uid,RecurrenceId:t.recurrenceId,Calendars:this.calendars,SelectedCalendar:t.calendarId,AllDay:t.allDay,Location:t.location,Description:t.description,Subject:t.subject,Alarms:t.alarms,Attendees:t.attendees,RRule:t.rrule,Excluded:!1,Owner:t.owner,Appointment:!1,OwnerName:t.ownerName,TimeFormat:this.sTimeFormat(),DateFormat:f.dateFormat(),AllEvents:e,CallbackSave:i.bind(this.updateTask,this),CallbackDelete:i.bind(this.executeRemove,this),Type:t.type,Status:t.status,IsTaskApp:!0};e!==Enums.CalendarEditRecurrenceEvent.None&&(t.start&&t.end&&(s.Start=t.start.clone(),s.Start=s.Start.local(),s.End=t.end.clone(),s.End=s.End.local()),b.showPopup(v,[s]))}),this)(Enums.CalendarEditRecurrenceEvent.AllEvents)},E.prototype.updateTask=function(t){var e=this.getParamsFromEventData(t);c.send("Calendar","UpdateEvent",e,this.onUpdateTaskResponse,this)},E.prototype.onUpdateTaskResponse=function(t,e){var s=t.Result;if(s){var n=s.Events[0].uid,a=this.getTaskFromList(n);if(a){a=this.prepareTask(s.Events[0]);var r=i.findIndex(this.tasksList(),(function(t){return t.uid===n}));r>=0&&this.tasksList.splice(r,1,a),this.sortTasksList()}}else u.showErrorByCode(t)},E.prototype.executeRemove=function(t){c.send("Calendar","DeleteEvent",{calendarId:t.calendarId,uid:t.uid},this.onDeleteTaskResponse,this)},E.prototype.onDeleteTaskResponse=function(t,e){if(t.Result){var s=e.Parameters.uid;this.getTaskFromList(s)&&this.tasksList(i.without(this.tasksList(),i.findWhere(this.tasksList(),{uid:s})))}else u.showErrorByCode(t)},E.prototype.updateTaskStatus=function(t){c.send("Calendar","UpdateTask",{CalendarId:t.calendarId,TaskId:t.uid,Subject:t.subject,Status:t.checked(),WithDate:t.withDate()},this.onUpdateTaskStatusResponse,this)},E.prototype.onUpdateTaskStatusResponse=function(t,e){t.Result||u.showErrorByCode(t)},E.prototype.getDateWithoutYearIfMonthWord=function(t){var e=t.split(" "),s=r().format("YYYY");return 3===e.length&&s===e[2]?e[0]+" "+e[1]:t},E.prototype.onShowCompletedClick=function(){this.showCompleted(!this.showCompleted()),this.searchSubmit()},t.exports=new E},tqo6:function(t,e,s){"use strict";var i=s("F/us"),n=s("EVdn"),a=s("AFLV");t.exports={ServerModuleName:"Calendar",HashModuleName:"calendar",ServerMeetingsPluginName:"CalendarMeetingsPlugin",ServerCorporateCalendarName:"CorporateCalendar",AddDescriptionToTitle:!1,AllowAppointments:!0,AllowShare:!1,AllowTasks:!0,DefaultTab:"3",HighlightWorkingDays:!0,HighlightWorkingHours:!0,PublicCalendarId:"",WeekStartsOn:"0",WorkdayEnds:"18",WorkdayStarts:"9",init:function(t){var e=t[this.ServerModuleName],s=t[this.ServerMeetingsPluginName],r=t[this.ServerCorporateCalendarName];i.isEmpty(e)||(this.AddDescriptionToTitle=a.pBool(e.AddDescriptionToTitle,this.AddDescriptionToTitle),this.AddDescriptionToTitle&&n("html").addClass("AddDescriptionToTitle"),i.isEmpty(r)||(this.AllowShare=a.pBool(r.AllowShare,this.AllowShare)),this.AllowTasks=a.pBool(e.AllowTasks,this.AllowTasks),this.DefaultTab=a.pString(e.DefaultTab,this.DefaultTab),this.HighlightWorkingDays=a.pBool(e.HighlightWorkingDays,this.HighlightWorkingDays),this.HighlightWorkingHours=a.pBool(e.HighlightWorkingHours,this.HighlightWorkingHours),this.PublicCalendarId=a.pString(e.PublicCalendarId,this.PublicCalendarId),this.WeekStartsOn=a.pString(e.WeekStartsOn,this.WeekStartsOn),this.WorkdayEnds=a.pString(e.WorkdayEnds,this.WorkdayEnds),this.WorkdayStarts=a.pString(e.WorkdayStarts,this.WorkdayStarts)),i.isEmpty(s)||(this.AllowAppointments=a.pBool(s.AllowAppointments,this.AllowAppointments))},update:function(t,e,s,i,n,a){this.DefaultTab=a.toString(),this.HighlightWorkingDays=t,this.HighlightWorkingHours=e,this.WeekStartsOn=n.toString(),this.WorkdayEnds=i.toString(),this.WorkdayStarts=s.toString()}}}}]);